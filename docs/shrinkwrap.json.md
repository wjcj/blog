npm-shrinkwrap.json vs package-lock.json
=======

## package-lock.json

`package-lock.json` æ˜¯æ•´ä¸ªåŒ…ä¾èµ–æ ‘çš„å¿«ç…§æ–‡ä»¶ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªç²¾ç¡®çš„ã€å¯é‡ç°çš„ `node_modules` æ ‘ã€‚npm åˆ©ç”¨å®ƒå®ç°é”å®šåŒ…ä¾èµ–é¡¹åŠå…¶å­ä¾èµ–é¡¹ï¼Œä»¥ä¿è¯åç»­å®‰è£…å¯ä»¥ç”Ÿæˆ `node_modules` æ ‘ã€‚<br/>
*[npm-shrinkwrap.json](#npm-shrinkwrap.json) ğŸ‘‡çš„åŠŸèƒ½å’Œè¡Œä¸ºä¸ `package-lock.json` ç±»ä¼¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°è¿™äº›æ–‡ä»¶åŒ…é”æˆ–é”æ–‡ä»¶ã€‚*

**ä»€ä¹ˆåœºæ™¯ä¸‹æˆ‘ä»¬æƒ³è¦é”å®šä¾èµ–ï¼Ÿ**

æˆ‘ä»¬æˆ–å¤šæˆ–å°‘é‡åˆ°è¿‡è¿™æ ·çš„åœºæ™¯ï¼Œæ¥è‡ªåŒä¸€ä»“åº“çš„ç›¸åŒä»£ç ï¼Œè‡ªå·±ç”µè„‘é‡Œæ­£å¸¸ï¼Œä½†åŒäº‹æ‹‰å–ååœ¨ä»–çš„ç”µè„‘é‡Œè¿è¡Œå´æŠ¥é”™ï¼›æˆ–è€…è‡ªå·±æœ¬åœ°è°ƒè¯•æ­£å¸¸ï¼Œåœ¨CIä¸Šè¿›è¡Œæ‰“åŒ…å‘å¸ƒæµ‹è¯•ç¯å¢ƒæˆ–è€…éƒ¨ç½²çº¿ä¸Šåå´å‡ºç°äº†bugã€‚ç±»ä¼¼è¿™äº›æƒ…å†µé€šå¸¸éƒ½æ˜¯ä¾èµ–æ ‘ä¸ä¸€è‡´å¯¼è‡´çš„æ‰“åŒ…ç»“æœå·®å¼‚ã€‚

è€Œæˆ‘ä»¬ä¸ä¼šæäº¤ `node-modules` ç›®å½•ï¼Œå› ä¸ºå®ƒå¤ªå¤§äº†ã€‚ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›ä»£ç æäº¤åˆ°ä»“åº“åï¼Œä»£ç ç”¨äºéƒ¨ç½²ã€CI/æŒç»­é›†æˆï¼Œæˆ–è€…å›¢é˜Ÿä¸­çš„ä»»ä½•äººæ‹‰å–åæœ¬åœ° `npm install` éƒ½èƒ½å¾—åˆ°å®Œå…¨ç›¸åŒçš„`node_modules` æ ‘ã€‚è¿™æ ·ä¸€æ¥åªè¦æœ¬åœ°åšå¥½å……åˆ†çš„æµ‹è¯•ï¼Œå³å¯å¾ˆå¤§ç¨‹åº¦ä¸Šä¿è¯ä¸Šè¿°åœºæ™¯åè¿è¡Œç»“æœä¸€è‡´ã€‚

è¿™æ ·ä¹Ÿä¼šå¯¼è‡´æ— æ³•äº«å—åˆ°[è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒ](https://semver.org/lang/zh-CN/) å¸¦æ¥çš„å¥½å¤„ï¼Œæ¯”å¦‚å½“ä½ å®‰è£…çš„ä¾èµ–åŒ…ååˆ†ç¨³å®šå¯é ï¼Œåœ¨ä¾èµ–ç‰ˆæœ¬å·ä¸Šæ­£ç¡®ä½¿ç”¨é™å®šè§„åˆ™ï¼ˆå¦‚`~1.2.2`ã€`^3.1.3`ï¼‰ï¼Œé›†æˆéƒ¨ç½²æ—¶å¦‚æœæ²¡æœ‰é”æ–‡ä»¶çš„å­˜åœ¨ï¼Œå°†ä¼šè‡ªåŠ¨å®‰è£…ä¿®è®¢ç‰ˆæœ¬ï¼Œå‘å¸ƒçº¿ä¸Šåä¸€äº›æ½œè—çš„éšæ‚£å¾—ä»¥è‡ªåŠ¨ä¿®å¤ã€‚ç›¸åçš„ï¼Œè¿™ä¹Ÿå¯èƒ½å¸¦æ¥æ›´å¤šä¸å¯æ§æ€§ï¼Œæ¯”å¦‚æ›´æ–°çš„ç‰ˆæœ¬å¯èƒ½å¸¦æ¥æ–°çš„bugï¼Œç”šè‡³æ˜¯ä¾èµ–æ ‘ä¸­çš„æŸä¸ªåŒ…å‘å¸ƒæ²¡æœ‰éµå®ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒï¼Œå¯¼è‡´ä¾èµ–æ–¹çš„è‡ªåŠ¨æ›´æ–°äº†ä¸ç¬¦åˆè¯­ä¹‰æœŸæœ›ã€‚

å¦‚æœä½ è®¤ä¸ºä¸èƒ½é”å®šä¾èµ–æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œä½ å°±éœ€è¦ç”Ÿæˆé”æ–‡ä»¶å¹¶æŠŠå®ƒæäº¤åˆ°ä»£ç ä»“åº“ã€‚

**ä¸ºä½• `package.json` ä¸èƒ½é”å®šä¾èµ–æ ‘ï¼Ÿ**

æœ€ä¸»è¦çš„åŸå› åœ¨äº `package.json` ä¸­ä¾èµ–é¡¹éƒ½æ˜¯é¡¶çº§ä¾èµ–ï¼Œè€Œä¸”é€šå¸¸æƒ…å†µä¸‹ä¾èµ–åŒ…çš„ç‰ˆæœ¬å·éƒ½æ˜¯ä¸æ˜¯ç²¾ç¡®ç‰ˆæœ¬ï¼Œè€Œæ˜¯åŒ¹é…äº†ä¸€ä¸ªä¿®è®¢ç‰ˆæœ¬æˆ–æ˜¯å¯å…¼å®¹ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼ˆ`~5.2.4`ï¼‰ã€‚è¿™æ—¶å¦‚æœè‡ªä¸Šæ¬¡å®‰è£…ä¾èµ–åŒ…ä¹‹åå‘å¸ƒäº†å¯ä»¥è¢«åŒ¹é…çš„æ–°ç‰ˆæœ¬ï¼Œnpm ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼ˆ`~5.2.5`ï¼‰ï¼›æˆ–è€…æŸä¾èµ– a ä¹‹ä¸€å­ä¾èµ–é¡¹ b å¯èƒ½å·²å‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œå³ä¾¿ä½ å¯¹ a ä½¿ç”¨å›ºå®šç‰ˆæœ¬å·ï¼ˆæ¯”å¦‚ `1.2.3` è€Œä¸æ˜¯ `^1.2.3`ï¼‰ï¼Œè¯¥ b ç‰ˆæœ¬è¿˜æ˜¯ä¼šæ›´æ–°ï¼Œå› ä¸ºé™¤éä½ æ˜¯ a çš„ä½œè€…ï¼Œå¦åˆ™ä½ æ²¡åŠæ³•è®© a å›ºå®š b çš„ç‰ˆæœ¬å·ã€‚

**ç”Ÿæˆä¸æ›´æ–° `package-lock.json` ï¼Ÿ**

ç”±äº `package-lock` æ˜¯ npm5 æ–°å¢çš„ç‰¹æ€§ï¼Œä¸”å› ä¸º `>= 5.0.0 <=5.4.2` npm ç‰ˆæœ¬å…³äº `package-lock.json` ä½¿ç”¨å’Œæ›´æ–°ç­–ç•¥ä¸Šéƒ½å­˜åœ¨é‡å¤§ç¼ºé™·ï¼Œè¯¦è§ [issue #16866](https://github.com/npm/npm/issues/16866)ã€[issue #17979](https://github.com/npm/npm/issues/17979)ã€‚æ•…æ¨èä½¿ç”¨ `>=5.4.2` çš„ npm ç‰ˆæœ¬ã€‚

å½“é¡¹ç›®ä¸­å­˜åœ¨ `package.json` æ—¶ï¼Œæ‰§è¡Œ `npm install` å³å¯ç”Ÿæˆ `package-lock.json` æ–‡ä»¶ã€‚

> any commands that update node_modules and/or package.json's dependencies will automatically sync the existing lockfile. This includes npm install, npm rm, npm update , etc.

å®˜æ–¹[æ–‡æ¡£](https://docs.npmjs.com/cli/v6/configuring-npm/package-locks#using-locked-packages)ä¸­ç§°ä»»ä½•æ›´æ–° `node_modules` å’Œ/æˆ– `package.json` ä¾èµ–é¡¹çš„å‘½ä»¤éƒ½ä¼šè‡ªåŠ¨åŒæ­¥ç°æœ‰çš„é”æ–‡ä»¶ã€‚åŒ…æ‹¬ `npm install`ã€`npm rm`ã€`npm update` ç­‰ã€‚

æ›´è¯¦ç»†åŒæ­¥ç­–ç•¥æ˜¯ï¼š
- `package-lock.json` ä¸å­˜åœ¨æ—¶ï¼Œ`npm install` æ ¹æ® `package.json` å®‰è£…ä¾èµ–å¹¶åˆ›å»º `package-lock.json`ã€‚
- `package.json` ä¸­ä¾èµ–é¡¹æˆ–ä½¿ç”¨ `npm install <PACKAGE>` å®‰è£…ä¸ `package-lock.json` ä¸­ç‰ˆæœ¬ä¸å…¼å®¹æ—¶ ï¼Œ`npm install` æ ¹æ® `package-lock.json` å®‰è£…ä¾èµ–é¡¹ã€‚
- å¦‚æ‰‹åŠ¨ä¿®æ”¹ `package.json` æŸä¾èµ–é¡¹å¹¶å¯¼è‡´ä¸ `package-lock.json` é”å®šä¾èµ–ç‰ˆæœ¬ä¸å…¼å®¹æ—¶ï¼Œ`package-lock.json` å°†æ›´æ–°åˆ°å…¼å®¹ `package.json` çš„ç‰ˆæœ¬ã€‚

## npm-shrinkwrap.json

`npm-shrinkwrap.json` é€šè¿‡ `npm shrinkwrap` å‘½ä»¤æ‰‹åŠ¨åˆ›å»ºï¼Œå¦‚æœæ ¹ç›®å½•å·²å­˜åœ¨ `package-lock.json` æ–‡ä»¶ï¼Œåˆ™ä¼šå°† `package-lock` é‡å‘½åä¸º `npm-shrinkwrap`ã€‚

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯npm v5ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå› ä¸ºè¿˜ä¸æ”¯æŒ `package-lock.json`ï¼Œéœ€è¦ä½¿ç”¨ `npm-shrinkwrap.json` å®ç°é”å®šä¾èµ–é¡¹çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å®ƒä¸ `package-lock.json` å…·æœ‰ç›¸åŒçš„æ ¼å¼ï¼Œæ‰§è¡Œç±»ä¼¼çš„åŠŸèƒ½ã€‚å”¯ä¸€åŒºåˆ«åœ¨äº `npm-shrinkwrap.json` å…è®¸å‘å¸ƒåˆ° npm ä¸Šï¼ˆè®¾ç½®`package.json#files` å­—æ®µå°†å…¶è®¾ç½®ä¸ºå‘å¸ƒå†…å®¹ï¼‰ï¼Œè€Œ `package-lock.json` æ°¸è¿œå‘è¢« npm è‡ªåŠ¨å¿½ç•¥ã€‚<br/>
å¦‚æœ `package-lock.json` å’Œ `npm-shrinkwrap.json` åŒæ—¶å­˜åœ¨äºæ ¹ç›®å½•ä¸­æ—¶ `npm-shrinkwrap` å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œ`package-lock.json` å°†è¢«å¿½ç•¥ã€‚

> It's strongly discouraged for library authors to publish this file, since that would prevent end users from having control over transitive dependency updates.

è™½ç„¶ `npm-shrinkwrap` å…è®¸å‘å¸ƒï¼Œä½†å®˜æ–¹å»ºè®® â€œå¼ºçƒˆä¸é¼“åŠ±åº“ä½œè€…å‘å¸ƒæ­¤æ–‡ä»¶ï¼Œå› ä¸ºè¿™ä¼šé˜»æ­¢æœ€ç»ˆç”¨æˆ·æ§åˆ¶ä¼ é€’ä¾èµ–é¡¹æ›´æ–°â€ã€‚è¿™é‡Œçš„ç›®çš„æ˜¯å¸Œæœ›æŠŠé€‰æ‹©æƒäº¤ç»™æœ€ç»ˆçš„åŒ…ä½¿ç”¨è€…ï¼Œå¦‚æœç”¨æˆ·ä¸å¸Œæœ›é”å®šä¾èµ–æ ‘ï¼Œå‘å¸ƒæ­¤æ–‡ä»¶çš„åŒ…çš„ä¾èµ–é¡¹ä¸­å¦‚æœæœ‰å¯æ›´æ–°çš„ä¾èµ–ä¹Ÿå°†ä¸èƒ½è‡ªåŠ¨æ›´æ–°ã€‚

## å‚è€ƒ

- [shrinkwrap.json | npm Docs](https://docs.npmjs.com/cli/v6/configuring-npm/shrinkwrap-json)
- [package-locks | npm Docs](https://docs.npmjs.com/cli/v6/configuring-npm/package-locks)